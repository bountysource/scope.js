/*! scope.js 0.5.0 2013-05-16 */
var scope=function(e,t){return e?!t||scope.instance[t]?(scope.instance[e]||(scope.instance[e]=scope.create_context(t?scope.instance[t]:scope.instance)),scope.instance[e]):(alert("Invalid scope parent: "+t),void 0):scope.instance};with(scope.initial_state=function(){return{data_logs:[],data_observers:[],data_hash:{},layouts:{},routes:[],refs:{}}},scope.state=scope.initial_state(),scope.create_context=function(e){function t(){}t.prototype=e;var n=new t;return n.__proto__||(n.__proto__=e),n},scope.instance=scope.create_context({define:function(e,t){this[e]=t}}),window.console||(window.console={log:function(){}}),scope())define("redefine",function(e,t){var n=this[e];define(e,function(){return t.apply(this,[n].concat(Array.prototype.slice.call(arguments)))})}),define("stop_event",function(e){e&&(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0,e.returnValue=!1)}),define("flatten_to_array",function(){for(var e=Array.prototype.slice.call(arguments),t=[];e.length>0;){var n=e.shift();(n||"number"==typeof n)&&("object"==typeof n&&n.concat?e=n.concat(e):"object"==typeof n&&n.callee||Object.prototype.toString.call(n).indexOf("NodeList")>=0?e=Array.prototype.slice.call(n).concat(e):t.push(n))}return t}),define("shift_options_from_args",function(e){return"object"==typeof e[0]&&e[0].nodeType===void 0?e.shift():"object"==typeof e[e.length-1]&&e[e.length-1].nodeType===void 0?e.pop():{}}),define("shift_callback_from_args",function(e){return"function"==typeof e[0]?e.shift():"function"==typeof e[e.length-1]?e.pop():function(){}}),define("for_each",function(){for(var e=flatten_to_array(arguments),t=e.pop(),n=[],o=0;e.length>o;o++)n.push(t(e[o]));return n}),define("curry",function(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(this,Array.prototype.concat.apply(t,arguments))}}),define("filter",function(e,t){for(var n=[],o=0;e.length>o;o++)t(e[o])&&n.push(e[o]);return n}),define("encode_html",function(e){return encodeURIComponent(e)}),define("decode_html",function(e){return decodeURIComponent(e)}),define("merge",function(e,t){var n={};for(var o in e)n[o]=e[o];for(var r in t)n[r]=t[r];return n});with(scope())scope.__initializers=[],define("initializer",function(e){scope.__initializers.push(e)}),window.onload=function(){for(var e=0;scope.__initializers.length>e;e++)scope.__initializers[e]();delete scope.__initializers};with(scope())define("render",function(){var e=flatten_to_array(arguments),t=shift_options_from_args(e);if(t.layout&&!scope.state.layouts[t.layout])throw Error("Layout not found: "+t.layout);if(t.layout!==!1&&!t.into&&scope.state.layouts["default"]&&(t.layout="default"),t.into||(t.into=document.body),"string"==typeof t.into&&(t.into=document.getElementById(t.into)),scope.state.layouts[t.layout]){if(!scope.state.layouts[t.layout].root_element){var n=div(),o=div();if(render({into:n},curry(scope.state.layouts[t.layout].callback,o)),1!=n.childNodes.length)throw Error("Expected a single element returned from layout: "+layout.name);if(scope.state.layouts[t.layout].root_element=n.firstChild,1!=o.parentNode.childNodes.length||o.parentNode.childNodes[0]!=o)throw Error("Expected layout to render arguments in an element with no siblings (i.e. div(arguments) ): "+layout.name);scope.state.layouts[t.layout].target_element=o.parentNode}scope.state.layouts[t.layout].root_element.parentNode!=t.into&&render({into:t.into},scope.state.layouts[t.layout].root_element),t.into=scope.state.layouts[t.layout].target_element}t.into.innerHTML&&(t.into.innerHTML="");for(var r=0;e.length>=r;r++){var a=e[r];"function"==typeof a&&(a=observe(a,function(e,t){return e===void 0&&(e=""),["string","boolean","number"].indexOf(typeof e)>=0&&(e=document.createTextNode(""+e)),t&&t.parentNode&&(t.parentNode.insertBefore(e,t),t.parentNode.removeChild(t)),e})),["string","boolean","number"].indexOf(typeof a)>=0&&(a=document.createTextNode(""+a)),a&&t.into.appendChild(a)}}),define("layout",function(e,t){scope.state.layouts[e]={name:e,callback:t}}),define("element",function(){var e=flatten_to_array(arguments),t=e.shift(),n=shift_options_from_args(e),o=document.createElement(t);if(n.type&&(o.setAttribute("type",n.type),delete n.type),n.events){for(var r in n.events)n["on"+r]=n.events[r];delete n.events}for(var a in n)if(0===a.indexOf("on")){var i=function(e){return function(){e.apply(o,Array.prototype.slice.call(arguments))}}(n[a]);o.addEventListener?o.addEventListener(a.substring(2).toLowerCase(),i,!1):o.attachEvent(a.toLowerCase(),i),delete n[a]}for(var s in n)if("function"==typeof n[s]){var c=s;observe(n[s],function(e){set_attribute(o,c,e)})}else set_attribute(o,s,n[s]);return e.length>0&&render({into:o},e),o}),define("set_attribute",function(e,t,n){if("class"==t)e.className=n;else if("style"==t)e.style.cssText=n;else if("placeholder"==t)e.setAttribute(t,n+" ");else if("html"==t||"innerhtml"==t.toLowerCase())e.innerHTML=n;else if("checked"==t)e.checked=!!n;else if(void 0===n||null===n);else{if("object"==typeof n)throw Error("Not expecting object attribute: "+t);e.setAttribute(t,n)}}),for_each("script","meta","title","link","script","iframe","h1","h2","h3","h4","h5","h6","small","div","p","span","pre","img","br","hr","i","b","strong","u","ul","ol","li","dl","dt","dd","table","tr","td","th","thead","tbody","tfoot","option","optgroup","textarea","button","label","fieldset","header","section","footer",function(e){define(e,function(){return element(e,arguments)})}),define("a",function(){var e=flatten_to_array(arguments),t=shift_options_from_args(e);if(t.href&&t.href.call){var n=t.href;t.href="",t.onClick=function(e){stop_event(e),n.call(e.target)}}return element("a",t,e)}),define("img",function(){var e=flatten_to_array(arguments),t=shift_options_from_args(e);return t.src||1!=e.length||(t.src=e.pop()),element("img",t,e)}),define("form",function(){var e=flatten_to_array(arguments),t=shift_options_from_args(e);if(t.action&&t.action.call){var n=t.action;t.onSubmit=function(e){stop_event(e),n(form_to_json(this))},t.action=""}return element("form",t,e)}),define("input",function(){var e=flatten_to_array(arguments),t=shift_options_from_args(e);return this[t.type||"text"](t,e)}),for_each("text","hidden","password","checkbox","radio","search","range","number","reset","submit","url","email",function(e){define(e,function(){var t=flatten_to_array(arguments),n=shift_options_from_args(t);return n.type=e,("submit"==e||"reset"==e)&&(n.value||1!=t.length||(n.value=t.pop())),element("input",n,t)})}),define("form_to_json",function(e){for(var t={},n=e.getElementsByTagName("*"),o=0;n.length>o;o++)if("FORM"!=n[o].tagName&&n[o].name){var r=null;n[o].getAttribute("placeholder")&&r==n[o].getAttribute("placeholder")?r="":"SELECT"==n[o].tagName?r=n[o].options[n[o].selectedIndex].value:(-1==["radio","checkbox"].indexOf(n[o].getAttribute("type"))||n[o].checked)&&(r=n[o].value);for(var a=t,i=n[o].name.split("["),s=0;i.length>s;s++){var c=i[s].replace(/\]$/,""),l=i[s+1]&&i[s+1].replace(/\]$/,"");if(void 0===l)a[c]=r;else{if(""===l){a[c]||(a[c]=[]),a[c].push(r);break}a[c]||(a[c]={}),a=a[c]}}}return t}),define("hash_to_query_string",function(e,t){var n="";for(var o in e){var r=t?t+"["+o+"]":o;if(void 0===e[o]||null===e[o]||e[o]===!1)n+="&"+r+"=";else if("object"==typeof e[o]&&e[o].pop)for(var a=0;e[o].length>a;a++)n+="&"+r+"[]="+encode_html(e[o][a]);else n+="object"==typeof e[o]?"&"+hash_to_query_string(e[o],r):"&"+r+"="+encode_html(e[o])}return n.replace(/^&/,"")}),define("remove_element",function(e){var t=document.getElementById(e);return t?t.parentNode.removeChild(t)&&!0:!1}),define("add_class",function(e,t){if(!e||has_class(e,t))return e;var n=e.className.split(/\s+/);return n.push(t),e.className=n.join(" "),e}),define("remove_class",function(e,t){return e&&has_class(e,t)?(e.className=e.className.replace(RegExp("\\s*"+t+"\\s*")," ").trim(),e):e}),define("has_class",function(e,t){var n=e.className.split(/\s+/);return n.indexOf(t)>=0}),define("toggle_class",function(e,t){has_class(e,t)?remove_class(e,t):add_class(e,t)}),define("hide",function(e){"string"==typeof e&&(e=document.getElementById(e)),e&&(e.style.display="none")}),define("show",function(e){"string"==typeof e&&(e=document.getElementById(e)),e&&(e.style.display="block")}),define("is_visible",function(e){return"string"==typeof e&&(e=document.getElementById(e)),"none"!=e.style.display}),define("toggle_visibility",function(e){"string"==typeof e&&(e=document.getElementById(e)),(is_visible(e)?hide:show)(e)}),define("inner_html",function(e,t){"string"==typeof e&&(e=document.getElementById(e)),e&&(e.innerHTML=t)}),define("in_dom",function(e){return null===e.parentNode?!1:e.parentNode==document.body?!0:in_dom(e)});with(scope())define("before_filter",function(e,t){t||(t=e,e=null),this.hasOwnProperty("before_filters")||(this.before_filters=[]),this.before_filters.push({name:e,callback:t,context:this})}),define("after_filter",function(e,t){t||(t=e,e=null),this.hasOwnProperty("after_filters")||(this.after_filters=[]),this.after_filters.push({name:e,callback:t,context:this})}),define("run_filters",function(e){for(var t=[],n=this,o=this;n;)n.__proto__&&n[e+"_filters"]!=n.__proto__[e+"_filters"]&&(t=n[e+"_filters"].concat(t)),n=n.__proto__;for(var r=0;t.length>r;r++)if(scope.running_filters=!0,t[r].callback.call(o),delete scope.running_filters,scope.filter_performed_action){var a=scope.filter_performed_action;return delete scope.filter_performed_action,a.call(t[r].context),void 0}return!0});with(scope("JSONP"))initializer(function(){scope.jsonp_callback_sequence=0,scope.jsonp_callbacks={}}),define("get",function(e){var t="callback_"+scope.jsonp_callback_sequence++,n=e.url;e.params||(e.params={}),e.params.cache=(new Date).getTime(),e.params.callback="scope.jsonp_callbacks."+t,"GET"!=e.method&&(e.params._method=e.method),n+=(-1==n.indexOf("?")?"?":"&")+hash_to_query_string(e.params);var o=document.createElement("script");o.async=!0,o.type="text/javascript",o.src=n,scope.jsonp_callbacks[t]=function(n){delete scope.jsonp_callbacks[t];var r=document.getElementsByTagName("head")[0];r.removeChild(o),e.callback.call(null,n)};var r=document.getElementsByTagName("head")[0];r.appendChild(o)});with(scope())define("observe",function(e,t,n){scope.state.data_logs.push([]);var o=e();t(o,n);var r=scope.state.data_logs.pop();return r.length>0&&scope.state.data_observers.push({keys:r,retval:o,method:e,callback:t}),o}),define("set",function(e,t){console.log("SETTING ",e,t),scope.state.data_hash[e]=t;for(var n=[],o=[],r=0;scope.state.data_observers.length>r;r++){var a=scope.state.data_observers[r];console.log(a,e,a.keys.indexOf(e)),-1!=a.keys.indexOf(e)?(console.log("running"),n.push(scope.state.data_observers[r])):(console.log("skipping"),o.push(scope.state.data_observers[r]))}console.log(n,o),scope.state.data_observers=o;for(var i=0;n.length>i;i++)observe(n[i].method,n[i].callback,n[i].retval);return null}),define("get",function(e){var t=scope.state.data_logs[scope.state.data_logs.length-1];return console.log("logging get",e),t&&-1==t.indexOf(e)&&t.push(e),scope.state.data_hash[e]});with(scope())initializer(function(){var e=function(){setTimeout(e,100);var t=get_route();t!=scope.current_route&&set_route(t,{skip_updating_browser_bar:!0})};scope.state.routes.length>0&&setTimeout(e,0)}),define("route",function(e,t){if("string"==typeof e)scope.state.routes.push({regex:RegExp("^"+e.replace(/^#\//,"#").replace(/:[a-z_]+/g,"([^/]*)")+"$"),callback:t,context:this});else for(var n in e)this.route(n,e[n])}),define("get_route",function(){var e="#"+((window.location.href.match(/#\/?(.*)/)||[])[1]||"").split("?")[0];return e}),define("get_params",function(){for(var e={},t=(window.location.href.match(/#?\/?.*?\?(.*)/)||[])[1]||"",n=t.split("&"),o=0;n.length>o;o++){var r=e,a=n[o].split("=",2);if(2==a.length){var i=unescape(a[1]);"true"==i?i=!0:"false"==i&&(i=!1);for(var s=unescape(a[0]).split("["),c=0;s.length>c;c++){var l=s[c].replace(/\]$/,""),f=s.length>c+1?s[c+1].replace(/\]$/,""):null;null===f?""===l?r.push(i):r[l]=i:(r[l]||(r[l]=""===f?[]:{}),r=r[l])}}}return e}),define("to_param",function(e){var t="";for(var n in e)t+=(0===t.length?"?":"&")+n+"="+e[n];return t}),define("set_route",function(e,t){if(!e.match(/^#/)){if(window.location.href.split("#")[0]!=e.split("#")[0])return window.location.href=e,void 0;e="#"+e.split("#",2)[1]}return e=e.replace(/^#\//,"#"),t||(t={}),t.params&&(query_string&&(e=e.split("?")[0]),e+=to_param(t.params)),t.skip_updating_browser_bar||(t.replace?window.location.replace(window.location.href.split("#")[0]+e):window.location.href=window.location.href.split("#")[0]+e),scope.current_route=e,t.reload_page?(window.location.reload(),void 0):("object"==typeof _gaq&&_gaq.push(["_trackPageview",e]),e=get_route(),scope.instance.params=get_params(),run_route(e)||("object"==typeof _gaq&&_gaq.push(["_trackPageview","#not_found?path="+encodeURIComponent(e)]),run_route("#not_found")||alert("Page not found: "+e)),void 0)}),define("run_route",function(e){for(var t=0;scope.state.routes.length>t;t++){var n=scope.state.routes[t],o=e.match(n.regex);if(o){if(window.scrollTo(0,0),!n.context.run_filters("before"))return;return n.callback.apply(null,o.slice(1)),n.context.run_filters("after"),!0}}});with(scope("StorageBase"))define("namespaced",function(e){return Storage.namespace?Storage.namespace+"_"+e:e}),define("strip_namespace",function(e){return Storage.namespace?e.replace(RegExp(Storage.namespace+"_"),""):e});with(scope("Cookies","StorageBase"))define("get",function(e){for(var t=document.cookie.split(";"),n=0;t.length>n;n++){for(;" "==t[n].charAt(0);)t[n]=t[n].substring(1,t[n].length);if(t[n].length>0){var o=t[n].split("=");if(o[0]==namespaced(e))return decodeURIComponent(o[1])}}}),define("set",function(e,t,n){n=n||{};var o=t?namespaced(e)+"="+encodeURIComponent(t)+"; path=/;":namespaced(e)+"=; path=/;";n.expires_at&&(o+="expires="+n.expires_at.toGMTString()),document.cookie=o}),define("remove",function(e){var t=get(e);return t?(document.cookie=namespaced(e)+"="+";path="+";expires=Thu, 01 Jan 1970 00:00:01 GMT",t):void 0}),define("clear",function(e){e=e||{};for(var t=document.cookie.split(";"),n=0;t.length>n;n++){var o=t[n].split("=")[0].replace(/\s+/,"");-1==(e.except||[]).map(namespaced).indexOf(o)&&remove(strip_namespace(o))}});with(scope("Local","StorageBase"))define("get",function(e){return window.localStorage.getItem(namespaced(e))}),define("set",function(e,t){window.localStorage.setItem(namespaced(e),t)}),define("remove",function(e){var t=get(e);return t?(window.localStorage.removeItem(namespaced(e)),t):void 0}),define("clear",function(e){e=e||{};for(var t in window.localStorage)-1==(e.except||[]).map(namespaced).indexOf(t)&&remove(strip_namespace(t))});scope("Storage","file:"==document.location.protocol||/\.dev$/.test(document.domain)?"Local":"Cookies");